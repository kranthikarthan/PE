@startuml MICROSERVICES_ARCHITECTURE
!theme plain
title Microservices Architecture & Service Mesh

package "Service Mesh Layer" {
    [Istio Service Mesh] as ISM
    [Envoy Proxy] as EP
    [Service Discovery] as SD
    [Load Balancer] as LB
    [Circuit Breaker] as CB
    [Retry Logic] as RL
}

package "API Gateway Services" {
    [Gateway Service] as GS
    [Authentication Service] as AS
    [Rate Limiting Service] as RLS
    [Routing Service] as RS
}

package "Core Business Services" {
    [Payment Processing Service] as PPS
    [Account Management Service] as AMS
    [Transaction Service] as TS
    [Notification Service] as NS
}

package "ISO 20022 Services" {
    [Message Flow Service] as MFS
    [Transformation Service] as TS2
    [Validation Service] as VS
    [Routing Service] as RS2
}

package "Configuration Services" {
    [Tenant Config Service] as TCS
    [Scheme Config Service] as SCS
    [Clearing System Config Service] as CSCS
    [Routing Config Service] as RCS
}

package "Integration Services" {
    [Clearing System Adapter] as CSA
    [Webhook Service] as WS
    [Kafka Producer Service] as KPS
    [Kafka Consumer Service] as KCS
}

package "Infrastructure Services" {
    [Database Service] as DBS
    [Cache Service] as CS
    [Message Queue Service] as MQS
    [File Storage Service] as FSS
}

package "Monitoring Services" {
    [Metrics Service] as MS
    [Logging Service] as LS
    [Tracing Service] as TS3
    [Health Check Service] as HCS
}

package "Security Services" {
    [Authentication Service] as AS2
    [Authorization Service] as AZS
    [Encryption Service] as ES
    [Audit Service] as AS3
}

package "External Services" {
    [Clearing Systems] as CS2
    [Client Systems] as ClientSys
    [Third Party APIs] as TPA
    [Regulatory Systems] as RS3
}

' Service mesh connections
ISM --> EP : Proxy Management
EP --> SD : Service Discovery
EP --> LB : Load Balancing
EP --> CB : Circuit Breaking
EP --> RL : Retry Logic

' API Gateway connections
GS --> AS : Authentication
GS --> RLS : Rate Limiting
GS --> RS : Request Routing

' Core business service connections
PPS --> AMS : Account Operations
PPS --> TS : Transaction Processing
PPS --> NS : Notifications

' ISO 20022 service connections
MFS --> TS2 : Message Transformation
MFS --> VS : Message Validation
MFS --> RS2 : Message Routing

' Configuration service connections
TCS --> SCS : Scheme Configuration
TCS --> CSCS : Clearing System Config
TCS --> RCS : Routing Configuration

' Integration service connections
CSA --> WS : Webhook Delivery
CSA --> KPS : Message Production
KCS --> MFS : Message Consumption

' Infrastructure service connections
DBS --> CS : Cache Operations
DBS --> MQS : Message Queue
MQS --> FSS : File Storage

' Monitoring service connections
MS --> LS : Log Aggregation
MS --> TS3 : Trace Collection
MS --> HCS : Health Monitoring

' Security service connections
AS2 --> AZS : Authorization
AS2 --> ES : Encryption
AS2 --> AS3 : Audit Logging

' External service connections
CSA --> CS2 : Clearing System Integration
WS --> ClientSys : Client Notifications
KPS --> TPA : Third Party Integration
AS3 --> RS3 : Regulatory Reporting

' Cross-service connections
PPS --> MFS : Message Processing
MFS --> CSA : External Integration
TCS --> PPS : Configuration
SCS --> MFS : Scheme Configuration
CSCS --> CSA : Clearing System Config

' Service mesh integration
EP --> GS : Gateway Proxy
EP --> PPS : Payment Service Proxy
EP --> MFS : Message Service Proxy
EP --> TCS : Config Service Proxy
EP --> CSA : Integration Service Proxy

note right of ISM
Istio Service Mesh:
- Service discovery
- Load balancing
- Circuit breaking
- Retry logic
- Timeout management
- Security policies
- Observability
end note

note right of GS
Gateway Service:
- API routing
- Authentication
- Rate limiting
- Request transformation
- Response transformation
- Health checks
end note

note right of PPS
Payment Processing Service:
- Payment orchestration
- Business logic
- State management
- Error handling
- Performance optimization
- Scalability
end note

note right of MFS
Message Flow Service:
- ISO 20022 processing
- Message orchestration
- Flow management
- Error handling
- Performance monitoring
- Audit logging
end note

note right of TCS
Tenant Config Service:
- Configuration management
- Multi-tenancy
- Dynamic configuration
- Configuration validation
- Version control
- Rollback support
end note

note right of CSA
Clearing System Adapter:
- Protocol translation
- Message transformation
- Authentication handling
- Error handling
- Retry logic
- Performance optimization
end note

note right of DBS
Database Service:
- Data persistence
- Transaction management
- Connection pooling
- Performance optimization
- Backup and recovery
- High availability
end note

note right of MS
Metrics Service:
- Metrics collection
- Metrics aggregation
- Performance monitoring
- Business metrics
- Custom metrics
- Real-time monitoring
end note

note right of AS2
Authentication Service:
- User authentication
- Token management
- Session management
- Multi-factor authentication
- Security policies
- Audit logging
end note

@enduml