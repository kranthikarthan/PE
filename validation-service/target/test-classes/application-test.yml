spring:
  application:
    name: validation-service-test
  
  datasource:
    url: jdbc:postgresql://localhost:5432/validation_test
    username: test
    password: test
    driver-class-name: org.postgresql.Driver
    
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
        jdbc:
          time_zone: UTC
        
  flyway:
    enabled: false
    
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: validation-service-test
      auto-offset-reset: earliest
      enable-auto-commit: false
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "*"
        spring.json.use.type.headers: false
        spring.json.value.default.type: "com.payments.contracts.events.PaymentInitiatedEvent"
    producer:
      acks: all
      retries: 3
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      enable-idempotence: true
      max-in-flight-requests-per-connection: 1
      
  redis:
    host: localhost
    port: 6379
    timeout: 2000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0

# Validation Service Test Configuration
validation:
  topics:
    inbound:
      payment-initiated: payment-initiated
      payment-updated: payment-updated
      account-changed: account-changed
    outbound:
      payment-validated: payment-validated
      validation-failed: validation-failed
      fraud-detected: fraud-detected
      risk-assessment: risk-assessment
    partitions: 1
    replication-factor: 1
    retention-ms: 604800000  # 7 days
    
  rules:
    engine:
      type: drools
      rules-path: classpath:rules/
      cache-enabled: false
      cache-size: 100
      
  fraud:
    detection:
      enabled: true
      threshold: 75
      rules:
        velocity-check: true
        amount-anomaly: true
        account-pattern: true
        
  risk:
    assessment:
      enabled: true
      factors:
        amount: 0.3
        velocity: 0.2
        account-history: 0.2
        time-of-day: 0.1
        location: 0.2

# Logging Configuration
logging:
  level:
    com.payments.validation: DEBUG
    org.springframework.kafka: INFO
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%X{correlationId}] %logger{36} - %msg%n"
